{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://luciaclaw.com/schemas/chat-message.json",
  "title": "Chat Messages",
  "description": "Chat message schemas for user-agent conversation",
  "definitions": {
    "attachmentMimeType": {
      "type": "string",
      "enum": ["image/jpeg", "image/png", "image/gif", "image/webp", "application/pdf", "text/plain"]
    },
    "attachment": {
      "type": "object",
      "required": ["filename", "mimeType", "data", "size"],
      "properties": {
        "filename": { "type": "string", "minLength": 1 },
        "mimeType": { "$ref": "#/definitions/attachmentMimeType" },
        "data": { "type": "string", "minLength": 1 },
        "size": { "type": "integer", "minimum": 1 }
      },
      "additionalProperties": false
    }
  },
  "oneOf": [
    {
      "title": "ChatMessage",
      "description": "User sends a chat message",
      "type": "object",
      "required": ["id", "type", "timestamp", "payload"],
      "properties": {
        "id": { "type": "string", "format": "uuid" },
        "type": { "const": "chat.message" },
        "timestamp": { "type": "number" },
        "payload": {
          "type": "object",
          "required": ["content"],
          "properties": {
            "content": { "type": "string", "minLength": 1 },
            "model": { "type": "string" },
            "conversationId": { "type": "string" },
            "attachments": {
              "type": "array",
              "items": { "$ref": "#/definitions/attachment" },
              "maxItems": 5
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    {
      "title": "ChatResponse",
      "description": "Agent sends a complete response",
      "type": "object",
      "required": ["id", "type", "timestamp", "payload"],
      "properties": {
        "id": { "type": "string", "format": "uuid" },
        "type": { "const": "chat.response" },
        "timestamp": { "type": "number" },
        "payload": {
          "type": "object",
          "required": ["content"],
          "properties": {
            "content": { "type": "string" },
            "toolCalls": {
              "type": "array",
              "items": { "$ref": "https://luciaclaw.com/schemas/tool-call.json#/definitions/toolCallPayload" }
            },
            "model": { "type": "string" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    {
      "title": "ChatStreamChunk",
      "description": "Streaming chunk from agent",
      "type": "object",
      "required": ["id", "type", "timestamp", "payload"],
      "properties": {
        "id": { "type": "string", "format": "uuid" },
        "type": { "const": "chat.stream.chunk" },
        "timestamp": { "type": "number" },
        "payload": {
          "type": "object",
          "required": ["responseId", "delta", "index"],
          "properties": {
            "responseId": { "type": "string", "format": "uuid" },
            "delta": { "type": "string" },
            "index": { "type": "integer", "minimum": 0 }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    {
      "title": "ChatStreamEnd",
      "description": "End of streaming response",
      "type": "object",
      "required": ["id", "type", "timestamp", "payload"],
      "properties": {
        "id": { "type": "string", "format": "uuid" },
        "type": { "const": "chat.stream.end" },
        "timestamp": { "type": "number" },
        "payload": {
          "type": "object",
          "required": ["responseId", "content"],
          "properties": {
            "responseId": { "type": "string", "format": "uuid" },
            "content": { "type": "string" },
            "toolCalls": {
              "type": "array",
              "items": { "$ref": "https://luciaclaw.com/schemas/tool-call.json#/definitions/toolCallPayload" }
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  ]
}
